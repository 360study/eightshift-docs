<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Dependency injection container · Eightshift Docs</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Dependency injection is a way of implementing inversion of control design pattern. It&#x27;s used to handle the dependencies between multiple classes without the direct instantiation of one class in another - which causes tight coupling in the code, and makes it less testable and harder to maintain."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Dependency injection container · Eightshift Docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://infinum.github.io/eightshift-docs/"/><meta property="og:description" content="Dependency injection is a way of implementing inversion of control design pattern. It&#x27;s used to handle the dependencies between multiple classes without the direct instantiation of one class in another - which causes tight coupling in the code, and makes it less testable and harder to maintain."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/eightshift-docs/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/eightshift-docs/js/scrollSpy.js"></script><link rel="stylesheet" href="/eightshift-docs/css/main.css"/><script src="/eightshift-docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/eightshift-docs/"><img class="logo" src="/eightshift-docs/img/favicon.png" alt="Eightshift Docs"/><h2 class="headerTitleWithLogo">Eightshift Docs</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/eightshift-docs/getting-started" target="_self">Get Started</a></li><li class=""><a href="/eightshift-docs/documentation" target="_self">Docs</a></li><li class=""><a href="/eightshift-docs/docs/guides-index" target="_self">Guides</a></li><li class=""><a href="https://infinum.github.io/eightshift-frontend-libs/storybook/" target="_blank">Storybook</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Dependency injection container</h1></header><article><div><span><p>Dependency injection is a way of implementing inversion of control design pattern. It's used to handle the dependencies between multiple classes without the direct instantiation of one class in another - which causes tight coupling in the code, and makes it less testable and harder to maintain.</p>
<p>Eightshift libs are using <a href="http://php-di.org/">PHP-DI</a> as an implementation of a dependency injection container. We'll explain the implementation by following the <a href="https://github.com/infinum/eightshift-boilerplate/blob/develop/src/class-main.php">eightshift-boilerplate</a> example.</p>
<p>In your main class, which is used to store all the dependencies in your code, and which extends the main eightshift-lib class (<code>Eightshift_Libs\Core\Main</code>), you need to define a method called <code>get_service_classes()</code> which contains an array of service classes (those that have a way to register hooks in your WordPress project):</p>
<pre><code class="hljs css language-php"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_service_classes</span><span class="hljs-params">()</span> : <span class="hljs-title">array</span> </span>{
  <span class="hljs-keyword">return</span> [

    <span class="hljs-comment">// Config.</span>
    Config::class,

    <span class="hljs-comment">// Manifest.</span>
    Lib_Manifest\Manifest::class =&gt; [ Config::class ],

    <span class="hljs-comment">// I18n.</span>
    Lib_I18n\I18n::class =&gt; [ Config::class ],

    <span class="hljs-comment">// Enqueue.</span>
    Lib_Enqueue\Enqueue_Admin::class =&gt; [ Config::class, Lib_Manifest\Manifest::class ],
    Lib_Enqueue\Enqueue_Theme::class =&gt; [ Config::class, Lib_Manifest\Manifest::class ],
    Lib_Enqueue\Enqueue_Blocks::class =&gt; [ Config::class, Lib_Manifest\Manifest::class ],

    <span class="hljs-comment">// Login.</span>
    Lib_Login\Login::class,

    <span class="hljs-comment">// Media.</span>
    Media\Media::class,

    <span class="hljs-comment">// Admin.</span>
    Admin\Modify_Admin_Appearance::class,

    <span class="hljs-comment">// Menu.</span>
    Menu\Menu::class,

    <span class="hljs-comment">// Blocks.</span>
    Lib_Blocks\Blocks::class =&gt; [ Config::class ],
  ];
}
</code></pre>
<p>Whenever a class has a dependency on another class, you'd add this dependency through a process of constructor injection. For instance, the <code>Enqueue_Admin</code> class depends on both <code>Config</code> and <code>Manifest</code> classes. Looking at the <a href="https://github.com/infinum/eightshift-libs/blob/develop/src/enqueue/class-enqueue-admin.php">implementation</a> we have:</p>
<pre><code class="hljs css language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Enqueue_Admin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Service</span> </span>{
  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">( Config_Data $config, Manifest_Data $manifest )</span> </span>{
    <span class="hljs-keyword">$this</span>-&gt;config   = $config;
    <span class="hljs-keyword">$this</span>-&gt;manifest = $manifest;
  }
}
</code></pre>
<p>Notice that we could add <code>Lib_Manifest\Manifest</code> as a type hint in the constructor of the <code>Enqueue_Admin</code> class and <code>Lib_Manifest\Config</code> as well, but instead, we used their <em>interfaces</em>: <code>Config_Data</code> and <code>Manifest_Data</code>. If we used concrete classes, we wouldn't have to add these in the <code>get_service_classes()</code> method array, because the DI container lib would be able to figure out what class the <code>Enqueue_Admin</code> class uses as a dependency through a process called <a href="https://www.php.net/manual/en/intro.reflection.php">reflection</a>.</p>
<p>This, however, creates a tight coupling - the <code>Enqueue_Admin</code> class now <strong>always</strong> depends on these concrete classes, and we cannot easily replace them if we want to create automated tests.
This is why we use interfaces, since interface only mandates the contract our class needs to honor - not the implementation of that contract.</p>
<p>By adding the interfaces we need to say to our DI container what the classes, that implement these interfaces, actually are. This is why we needed to define:</p>
<pre><code class="hljs css language-php">Lib_Enqueue\Enqueue_Admin::class =&gt; [ Config::class, Lib_Manifest\Manifest::class ]
</code></pre>
<p>in our <code>get_service_classes()</code> method.</p>
<p>The beauty of this method is that we can easily add mocks in our automated tests:</p>
<pre><code class="hljs css language-php"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_service_classes</span><span class="hljs-params">()</span> : <span class="hljs-title">array</span> </span>{
  $services = [
    Lib_Enqueue\Enqueue_Admin::class =&gt; [ Config::class, Lib_Manifest\Manifest::class ],
    <span class="hljs-comment">// Other classes go here.</span>
  ];

  <span class="hljs-keyword">if</span> ( getenv(<span class="hljs-string">'TEST'</span>) ) {
    $services[ Lib_Enqueue\Enqueue_Admin::class ] =&gt; [ Fixture\Config::class, Fixture\Manifest::class ];
  }

  <span class="hljs-keyword">return</span> $services;
}
</code></pre>
<p>If we had an environment variable <code>TEST</code> defined in our <code>phpunit.xml</code> defined, this means that the <code>Lib_Enqueue\Enqueue_Admin</code> class will get overwritten during the test run, and we can pass the fake classes from the <code>Fixture</code> namespace.</p>
<p>This is just a simple example, but one that could prove useful when writing testable code in the future, and something to be mindful of.</p>
<h2><a class="anchor" aria-hidden="true" id="useful-hint"></a><a href="#useful-hint" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Useful hint</h2>
<p>Don't pass to many dependencies in your classes. Having more than three dependencies is usually a sign that your class may be doing too much, and that it should probably be broken down into more different classes.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2/9/2020 by Denis Žoljom</em></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#useful-hint">Useful hint</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/eightshift-docs/" class="nav-home"><img src="/eightshift-docs/img/favicon.png" alt="Eightshift Docs" width="66" height="58"/></a><div><h5>Eightshift-frontend-libs</h5><a href="https://github.com/infinum/eightshift-frontend-libs">Github</a><a class="github-button" href="https://github.com/infinum/eightshift-frontend-libs" data-icon="octicon-star" data-size="large" aria-label="Star infinum/eightshift-frontend-libs on GitHub">Star</a></div><div><h5>Eightshift-libs</h5><a href="https://github.com/infinum/eightshift-libs">Github</a><a class="github-button" href="https://github.com/infinum/eightshift-libs" data-icon="octicon-star" data-size="large" aria-label="Star infinum/eightshift-libs on GitHub">Star</a></div><div><h5>Eightshift-boilerplate</h5><a href="https://github.com/infinum/eightshift-boilerplate">Github</a><a class="github-button" href="https://github.com/infinum/eightshift-boilerplate" data-icon="octicon-star" data-size="large" aria-label="Star infinum/eightshift-boilerplate on GitHub">Star</a></div><div><h5>Eightshift-boilerplate-plugin</h5><a href="https://github.com/infinum/eightshift-boilerplate-plugin">Github</a><a class="github-button" href="https://github.com/infinum/eightshift-boilerplate-plugin" data-icon="octicon-star" data-size="large" aria-label="Star infinum/eightshift-boilerplate-plugin on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 Eightshift</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '921996f662a2a05c1ffbcf2a87146376',
                indexName: 'infinum_eightshift',
                inputSelector: '#search_input_react'
              });
            </script></body></html>