(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{211:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return i})),n.d(t,"default",(function(){return u}));var a=n(1),o=n(9),s=(n(0),n(249)),r={id:"autowiring",title:"Autowiring",sidebar_label:"Autowiring"},c={id:"basics/autowiring",title:"Autowiring",description:"[![docs-source](https://img.shields.io/badge/source-eigthshift--libs-blue?style=for-the-badge&logo=php&labelColor=2a2a2a)](https://github.com/infinum/eightshift-libs)",source:"@site/docs/basics/autowiring.md",permalink:"/eightshift-docs/docs/basics/autowiring",sidebar_label:"Autowiring",sidebar:"docs",previous:{title:"Extending Classes",permalink:"/eightshift-docs/docs/basics/extending-classes"},next:{title:"Example Class",permalink:"/eightshift-docs/docs/basics/example-class"}},i=[{value:"How it works?",id:"how-it-works",children:[{value:"What if I have to mock or manually call a class?",id:"what-if-i-have-to-mock-or-manually-call-a-class",children:[]},{value:"What if my class doesn&#39;t have anything inside a constructor method? (no dependencies)",id:"what-if-my-class-doesnt-have-anything-inside-a-constructor-method-no-dependencies",children:[]},{value:"What if my class has a <strong>primitive parameter</strong> (<code>string</code>, <code>int</code>, etc.) inside a constructor method?",id:"what-if-my-class-has-a-primitive-parameter-string-int-etc-inside-a-constructor-method",children:[]},{value:"What if my class does have another class as a parameter inside a constructor method?",id:"what-if-my-class-does-have-another-class-as-a-parameter-inside-a-constructor-method",children:[]},{value:"What if my class has an interface parameter inside the constructor method?",id:"what-if-my-class-has-an-interface-parameter-inside-the-constructor-method",children:[]}]},{value:"To sum it up",id:"to-sum-it-up",children:[]}],l={rightToc:i};function u(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(s.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/infinum/eightshift-libs"}),Object(s.b)("img",Object(a.a)({parentName:"a"},{src:"https://img.shields.io/badge/source-eigthshift--libs-blue?style=for-the-badge&logo=php&labelColor=2a2a2a",alt:"docs-source"})))),Object(s.b)("p",null,"What is autowiring?"),Object(s.b)("p",null,Object(s.b)("em",{parentName:"p"},"Autowiring is an exotic word that represents something very simple: the container's ability to create and inject dependencies automatically.")),Object(s.b)("p",null,"The quote is taken from ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://php-di.org/doc/autowiring.html"}),"PHP-DI")," library that we use."),Object(s.b)("p",null,"In a nutshell, we use a dependency injection (DI) container to load all your service classes. Alongside the DI container, we are also using the PSR-4 coding standard for autoloading. That allows us to predict how your file/folder structure will look like in correlation to the namespace. With that in mind, you don't have to worry about requiring your classes. Our autoloading takes care of everything. All you need to do is follow a few coding standards so that you can automatically inject other classes as dependencies."),Object(s.b)("p",null,"Autowiring runs inside the ",Object(s.b)("inlineCode",{parentName:"p"},"Main")," service class as an extended class of our ",Object(s.b)("inlineCode",{parentName:"p"},"AbstractMain")," class. You can install the main class using this command:"),Object(s.b)("p",null,Object(s.b)("inlineCode",{parentName:"p"},"wp boilerplate create_main")),Object(s.b)("h2",{id:"how-it-works"},"How it works?"),Object(s.b)("p",null,"Here is a quick overview of how this works:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"You create a new class manually or using the WP-CLI command."),Object(s.b)("li",{parentName:"ul"},"PSR-4 would detect your new class if you followed the PSR-4 naming standard."),Object(s.b)("li",{parentName:"ul"},"New class is added to the ",Object(s.b)("inlineCode",{parentName:"li"},"classmap")," array inside the ",Object(s.b)("inlineCode",{parentName:"li"},"vendor")," folder."),Object(s.b)("li",{parentName:"ul"},"Autowiring class reads the new class, checks if your class has any class dependencies and injects them."),Object(s.b)("li",{parentName:"ul"},"It just works.")),Object(s.b)("p",null,"Even shorter: you just add a new class (that's PSR-4 compliant) with or without some class dependencies and everything will be automatically resolved / injected."),Object(s.b)("h3",{id:"what-if-i-have-to-mock-or-manually-call-a-class"},"What if I have to mock or manually call a class?"),Object(s.b)("p",null,"Before we start with the automatization and autowiring let's see how services classes are called manually. "),Object(s.b)("p",null,"We can think of these scenarios where you want to load a class manually:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"You have to write tests and manually provide mocked classes."),Object(s.b)("li",{parentName:"ul"},"Your classes have some custom structure, and autowiring can't resolve it."),Object(s.b)("li",{parentName:"ul"},"You want to provide a primitive parameter (",Object(s.b)("inlineCode",{parentName:"li"},"string"),", ",Object(s.b)("inlineCode",{parentName:"li"},"int"),", etc.) inside a constructor method.")),Object(s.b)("p",null,"In those cases, you can manually provide your DI container with the implementation using the ",Object(s.b)("inlineCode",{parentName:"p"},"getServiceClasses")," method inside the ",Object(s.b)("inlineCode",{parentName:"p"},"src>Main>Main")," class."),Object(s.b)("p",null,"Just provide the method and add your custom implementation like this:"),Object(s.b)("p",null,Object(s.b)("inlineCode",{parentName:"p"},"src>Main>Main.php")),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"  /**\n   * Get the list of services to register.\n   *\n   * A list of classes which contain hooks.\n   *\n   * @return array<class-string, string|string[]> Array of fully qualified service class names.\n   */\n  protected function getServiceClasses(): array\n  {\n    return [\n\n      // If you are using a class as a DI.\n      ProjectNamespace\\Rest\\Routes\\DocumentsRoute::class => [ProjectNamespace\\Query\\Documents\\QueryDocuments::class],\n\n      // If you just want to include a simple class with no DI.\n      ProjectNamespace\\CoolFolder\\CoolClass::class,\n    ];\n  }\n")),Object(s.b)("h3",{id:"what-if-my-class-doesnt-have-anything-inside-a-constructor-method-no-dependencies"},"What if my class doesn't have anything inside a constructor method? (no dependencies)"),Object(s.b)("p",null,"If your class ",Object(s.b)("strong",{parentName:"p"},"doesn't have")," anything defined in the constructor method, autoloading will require your class.\nThis just means that you are not using dependency injection (as you have nothing to inject)."),Object(s.b)("h3",{id:"what-if-my-class-has-a-primitive-parameter-string-int-etc-inside-a-constructor-method"},"What if my class has a ",Object(s.b)("strong",{parentName:"h3"},"primitive parameter")," (",Object(s.b)("inlineCode",{parentName:"h3"},"string"),", ",Object(s.b)("inlineCode",{parentName:"h3"},"int"),", etc.) inside a constructor method?"),Object(s.b)("p",null,"If your class ",Object(s.b)("strong",{parentName:"p"},"has")," a primitive parameter defined in the constructor method, autowiring will ",Object(s.b)("strong",{parentName:"p"},"not know")," how to handle this because you manually need to provide the primitive parameters at the point of usage. For this you should check ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"#what-if-i-have-to-mock-or-manually-call-a-class"}),"this"),"."),Object(s.b)("h3",{id:"what-if-my-class-does-have-another-class-as-a-parameter-inside-a-constructor-method"},"What if my class does have another class as a parameter inside a constructor method?"),Object(s.b)("p",null,"This works out of the box, but you shouldn't really do this."),Object(s.b)("p",null,"A good coding practice is that your class should never depend on the concrete class implementation because you have tightly coupled your class to another class. This makes it hard to test and your code becomes hard to modify. Imagine that you have put a concrete implementation as a dependency, only to get feedback from the client that you need to change that implementation for a completely different one. Making the changes means that you'll need to track all the places in your codebase where you have used some functionality from this class, and change it completely."),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"You should always code against interfaces and not implementation.")),Object(s.b)("p",null,"We can't stress this enough because as your project grows, so will your headaches. Also, when you start testing your code, that is when your hair will begin to fall off. We recommend reading Uncle Bob Martin's ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"http://cleancoder.com/products"}),"Clean Code")," book. That will save you a lot of sleepless nights, and you'll learn tons of tips and tricks for writing clean code."),Object(s.b)("h3",{id:"what-if-my-class-has-an-interface-parameter-inside-the-constructor-method"},"What if my class has an interface parameter inside the constructor method?"),Object(s.b)("p",null,"This will automatically be resolved (same as with class parameters) if you follow 1 simple rule:"),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"Variable name in your constructor method needs to match the class name (which implements the interface) in camelCase.")),Object(s.b)("p",null,"For example, let's say you have a ",Object(s.b)("inlineCode",{parentName:"p"},"SteeringWheel")," class:"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"class SteeringWheel implements CarPartInterface\n")),Object(s.b)("p",null,"and you want to have this as a dependency in Car class. Your Car class has the following constructor:"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"public function __construct(CarPartInterface $steeringWheel)\n{\n  $this->steeringWheel = $steeringWheel;\n}\n")),Object(s.b)("p",null,"Since the injected variable name ",Object(s.b)("inlineCode",{parentName:"p"},"$steeringWheel")," is the camelCase version of the class name ",Object(s.b)("inlineCode",{parentName:"p"},"SteeringWheel")," which implements ",Object(s.b)("inlineCode",{parentName:"p"},"CarPartInterface"),", autowiring will know to inject the correct class and everything will work fine."),Object(s.b)("p",null,"If you understand everything from the upper example you can just skip this next example, but we recommend checking this next example for more detailed overview."),Object(s.b)("h4",{id:"example"},"Example"),Object(s.b)("p",null,"Let's set a scene. You have created a ",Object(s.b)("inlineCode",{parentName:"p"},"DocumentsRoute")," class and it needs some functionality from the ",Object(s.b)("inlineCode",{parentName:"p"},"QueryDocuments")," class."),Object(s.b)("p",null,"Steps you need to follow are:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"You should create an interface with all the methods you need in the ",Object(s.b)("inlineCode",{parentName:"li"},"DocumentsRoute")," class, let's call it ",Object(s.b)("inlineCode",{parentName:"li"},"QueryDocumentsInterface")," and we'll put it inside the ",Object(s.b)("inlineCode",{parentName:"li"},"src/Query/Documents")," folder."),Object(s.b)("li",{parentName:"ul"},"Your ",Object(s.b)("inlineCode",{parentName:"li"},"QueryDocuments")," class should implement your new ",Object(s.b)("inlineCode",{parentName:"li"},"QueryDocumentsInterface")," class and have all the methods from the interface implemented."),Object(s.b)("li",{parentName:"ul"},"In your ",Object(s.b)("inlineCode",{parentName:"li"},"DocumentsRoute")," class provide the ",Object(s.b)("inlineCode",{parentName:"li"},"QueryDocumentsInterface")," interface as a parameter inside the ",Object(s.b)("inlineCode",{parentName:"li"},"__construct")," method with the name of the argument ",Object(s.b)("inlineCode",{parentName:"li"},"$queryDocuments"),"."),Object(s.b)("li",{parentName:"ul"},"You can now use the methods defined in the ",Object(s.b)("inlineCode",{parentName:"li"},"QueryDocuments")," class.")),Object(s.b)("p",null,"Let's us provide you with some code examples:"),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Structure:")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"src",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"Query",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"Documents",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"QueryDocumentsInterface.class"),Object(s.b)("li",{parentName:"ul"},"QueryDocuments.class"))))),Object(s.b)("li",{parentName:"ul"},"Rest",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"Routes",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"DocumentsRoute.class")))))))),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"src/Query/Documents/QueryDocumentsInterface.php")),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"/**\n * The file that holds a QueryDocuments interface.\n *\n * @package ProjectNamespace\\Query\\Documents;\n */\n\ndeclare(strict_types=1);\n\nnamespace ProjectNamespace\\Query\\Documents;\n\n/**\n * Interface for querying documents\n */\ninterface QueryDocumentsInterface\n{\n\n  /**\n   * Get structured documents data for documents section.\n   *\n   * @param int $id Id for data.\n   *\n   * @return string\n   */\n  public function getDocumentsData(int $id = 0): string;\n}\n")),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"src/Query/Documents/QueryDocuments.php")),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"/**\n * The file for querying all the documents\n *\n * @package ProjectNamespace\\Query\\Documents\n */\n\ndeclare(strict_types=1);\n\nnamespace ProjectNamespace\\Query\\Documents;\n\nuse ProjectNamespaceVendor\\EightshiftLibs\\Services\\ServiceInterface;\n\n/**\n * QueryDocuments class.\n */\nclass QueryDocuments implements ServiceInterface, QueryDocumentsInterface\n{\n    /**\n   * Get structured documents data for documents section.\n   *\n   * @param int $id Id for data.\n   *\n   * @return string\n   */\n  public function getDocumentsData(int $id = 0): string\n  {\n    // here goes the implementation of getDocumentsData method.\n  }\n}\n")),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"src/Rest/Routes/DocumentsRoute.php")),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"/**\n * The class register route for DocumentsRoute endpoint\n *\n * @package ProjectNamespace\\Rest\\Routes\n */\n\ndeclare(strict_types=1);\n\nnamespace ProjectNamespace\\Rest\\Routes;\n\nuse ProjectNamespace\\Query\\Documents\\QueryDocumentsInterface;\nuse ProjectNamespaceVendor\\EightshiftLibs\\Rest\\Routes\\AbstractRoute;\nuse ProjectNamespaceVendor\\EightshiftLibs\\Rest\\CallableRouteInterface;\n\n/**\n * Class DocumentsRoute\n */\nclass DocumentsRoute extends AbstractRoute implements CallableRouteInterface\n{\n\n  /**\n   * Instance variable of documents data.\n   *\n   * @var QueryDocumentsInterface\n   */\n  protected $queryDocuments;\n\n  /**\n   * Create a new instance.\n   *\n   * @param QueryDocumentsInterface $queryDocuments Inject documentsData which holds data for documents.\n   */\n  public function __construct(QueryDocumentsInterface $queryDocuments)\n  {\n    $this->queryDocuments = $queryDocuments;\n  }\n\n  // here goes the rest of the DocumentsRoute implementation.\n}\n")),Object(s.b)("p",null,"And that's it. Autowiring knows how to resolve the dependencies, you didn't tightly couple the code, and you're all set."),Object(s.b)("h2",{id:"to-sum-it-up"},"To sum it up"),Object(s.b)("p",null,"This chapter may be a bit long, but we wanted to make sure you understand our motivation behind it. We often work on large projects, with lots of third-party integrations, and having a good project structure and architecture makes the projects more durable. It makes them less prone to bugs (if you write tests), makes the implementation of new features, and removing obsolete features a lot easier."),Object(s.b)("p",null,"Do you need to use it? Not really. Especially on really simple projects. Should you? We think you'll benefit from it in the long run"))}u.isMDXComponent=!0},249:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return b}));var a=n(0),o=n.n(a);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),u=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c({},t,{},e)),n},m=function(e){var t=u(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},p=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,r=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),m=u(n),p=a,b=m["".concat(r,".").concat(p)]||m[p]||d[p]||s;return n?o.a.createElement(b,c({ref:t},l,{components:n})):o.a.createElement(b,c({ref:t},l))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,r=new Array(s);r[0]=p;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:a,r[1]=c;for(var l=2;l<s;l++)r[l]=n[l];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);